const{execSync:execSync}=require("child_process"),commonExecGitStatement=t=>{try{return execSync(t,{encoding:"utf8"}).trim()}catch(t){return new Error("执行git命令失败")}},getGitBranch=()=>commonExecGitStatement("git symbolic-ref --short -q HEAD"),getGitName=()=>commonExecGitStatement("git config user.name"),getGitEmail=()=>commonExecGitStatement("git config user.email"),getGitShowRefTags=()=>{const t=commonExecGitStatement("git show-ref --tags");let e=[];return t&&"string"==typeof t&&(e=t.match(/refs\/tags\/.+/gi)),e},getLatestTagFromTagsArr=(t=[])=>{if(t){return t[t.length-1].replace("refs/tags/","")}return""},getGitLastCommitInfo=()=>({commitName:commonExecGitStatement("git log -1 --pretty=format:%cn"),commitEmail:commonExecGitStatement("git log -1 --pretty=format:%ce"),commitDate:commonExecGitStatement("git log -1 --pretty=format:%ci"),commitSubject:commonExecGitStatement("git log -1 --pretty=format:%s"),commitHash:commonExecGitStatement("git log -1 --pretty=format:%H")}),gitCommitInfo=()=>{const t=getGitBranch(),e=getGitName(),m=getGitEmail(),{commitName:i,commitEmail:o,commitDate:c,commitSubject:a,commitHash:r}=getGitLastCommitInfo(),n=getGitShowRefTags();return{branch:t,gitUserName:e,gitUserEmail:m,commitName:i,commitEmail:o,commitDate:c,commitSubject:a,commitHash:r,latestTag:getLatestTagFromTagsArr(n)}};module.exports=gitCommitInfo;