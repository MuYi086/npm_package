"use strict";var p=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var S=(t,r)=>{for(var e in r)p(t,e,{get:r[e],enumerable:!0})},d=(t,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of G(r))!N.call(t,n)&&n!==e&&p(t,n,{get:()=>r[n],enumerable:!(o=j(r,n))||o.enumerable});return t};var v=t=>d(p({},"__esModule",{value:!0}),t);var U={};S(U,{gitCommitInfo:()=>I});module.exports=v(U);var f=require("child_process"),i=t=>{try{return(0,f.execSync)(t,{encoding:"utf8"}).trim()}catch(r){return console.error(`\u6267\u884CGit\u547D\u4EE4 "${t}" \u51FA\u9519\uFF1A`,r),""}},x=()=>i("git symbolic-ref --short -q HEAD"),B=()=>i("git config user.name"),E=()=>i("git config user.email"),C=(t,r)=>{let e=t.replace("refs/tags/",""),o=r.replace("refs/tags/",""),n=e.replace(/^v/,""),u=o.replace(/^v/,""),c=n.split(".").map(s=>{let g=s.match(/^\d+/)?.[0]||"0";return parseInt(g,10)||0}),m=u.split(".").map(s=>{let g=s.match(/^\d+/)?.[0]||"0";return parseInt(g,10)||0}),a=Math.max(c.length,m.length);for(;c.length<a;)c.push(0);for(;m.length<a;)m.push(0);for(let s=0;s<a;s++)if(c[s]!==m[s])return c[s]-m[s];return 0},H=()=>{try{return(i("git show-ref --tags").match(/refs\/tags\/.+/ig)||[]).sort(C)}catch{return[]}},b=(t,r)=>{if(t.length>=Math.abs(r)){let e=t.length+r;if(e>=0)return t[e].replace("refs/tags/","")}return""},O=t=>b(t,-1),P=()=>{let r=i("git remote -v").match(/\/([^\/]+)\.git/);return r?r[1]:""},T=()=>{let t=i("git log -1 --pretty=format:%cn"),r=i("git log -1 --pretty=format:%ce"),e=i("git log -1 --pretty=format:%ci"),o=i("git log -1 --pretty=format:%s"),n=i("git log -1 --pretty=format:%H");return{commitName:t,commitEmail:r,commitDate:e,commitSubject:o,commitHash:n}},w=(t,r)=>{if(!t||!r)return[];try{let e=`git log ${r}..${t} --pretty=format:%s`,o=i(e);return o?o.split(`
`).filter(n=>n.trim()!==""):[]}catch(e){return console.error("\u83B7\u53D6tag\u4E4B\u95F4\u7684commit subject\u51FA\u9519\uFF1A",e),[]}},D=t=>b(t,-2),I=(t="")=>{let r=P(),e=x(),o=B(),n=E(),{commitName:u,commitEmail:c,commitDate:m,commitSubject:a,commitHash:s}=T(),g=H(),l=O(g);if(t==="prod"){let h=D(g),y=w(l,h);return{projectName:r,branch:e,gitUserName:o,gitUserEmail:n,commitName:u,commitEmail:c,commitDate:m,commitSubjects:y,commitHash:s,latestTag:l,previousTag:h}}return{projectName:r,branch:e,gitUserName:o,gitUserEmail:n,commitName:u,commitEmail:c,commitDate:m,commitSubject:a,commitHash:s,latestTag:l}};0&&(module.exports={gitCommitInfo});
