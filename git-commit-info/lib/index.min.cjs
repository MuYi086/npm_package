"use strict";var c=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var S=(t,r)=>{for(var e in r)c(t,e,{get:r[e],enumerable:!0})},E=(t,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of G(r))!N.call(t,n)&&n!==e&&c(t,n,{get:()=>r[n],enumerable:!(o=j(r,n))||o.enumerable});return t};var C=t=>E(c({},"__esModule",{value:!0}),t);var v={};S(v,{gitCommitInfo:()=>$});module.exports=C(v);var h=require("child_process"),i=t=>{try{return(0,h.execSync)(t,{encoding:"utf8"}).trim()}catch(r){return console.error(`\u6267\u884CGit\u547D\u4EE4 "${t}" \u51FA\u9519\uFF1A`,r),""}},H=()=>i("git symbolic-ref --short -q HEAD"),O=()=>i("git config user.name"),T=()=>i("git config user.email"),d=()=>{try{return i("git show-ref --tags").match(/refs\/tags\/.+/ig)||[]}catch{return[]}},p=(t,r)=>{if(t.length>=Math.abs(r)){let e=t.length+r;if(e>=0)return t[e].replace("refs/tags/","")}return""},x=t=>p(t,-1),D=()=>{let r=i("git remote -v").match(/\/([^\/]+)\.git/);return r?r[1]:""},U=()=>{let t=i("git log -1 --pretty=format:%cn"),r=i("git log -1 --pretty=format:%ce"),e=i("git log -1 --pretty=format:%ci"),o=i("git log -1 --pretty=format:%s"),n=i("git log -1 --pretty=format:%H");return{commitName:t,commitEmail:r,commitDate:e,commitSubject:o,commitHash:n}},B=(t,r)=>{if(!t||!r)return[];try{let e=`git log ${r}..${t} --pretty=format:%s`,o=i(e);return o?o.split(`
`).filter(n=>n.trim()!==""):[]}catch(e){return console.error("\u83B7\u53D6tag\u4E4B\u95F4\u7684commit subject\u51FA\u9519\uFF1A",e),[]}},P=t=>p(t,-2),$=(t="")=>{let r=D(),e=H(),o=O(),n=T(),{commitName:m,commitEmail:g,commitDate:a,commitSubject:b,commitHash:u}=U(),f=d(),s=x(f);if(t==="prod"){let l=P(f),y=B(s,l);return{projectName:r,branch:e,gitUserName:o,gitUserEmail:n,commitName:m,commitEmail:g,commitDate:a,commitSubjects:y,commitHash:u,latestTag:s,previousTag:l}}return{projectName:r,branch:e,gitUserName:o,gitUserEmail:n,commitName:m,commitEmail:g,commitDate:a,commitSubject:b,commitHash:u,latestTag:s}};0&&(module.exports={gitCommitInfo});
