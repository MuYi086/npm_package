class Calendar{constructor(){this.yearArr=[],this.monthArr=[],this.weekDay=[],this.gan=[],this.zhi=[],this.chineseZodiac=[],this.farmMonthArr=[],this.pingMonthArr=[],this.runMonthArr=[],this.farmDate=[],this.farmDateArr=[],this.today={},this.lastThreeMonthDay=[],this.currentMonthDay=[],this.currentMonthFarmDay=[],this.searchDay={year:1900,month:1,day:1},this.prevMonthObj={},this.nextMonthObj={},this.init()}init(){for(let t=1900;t<2051;t++)this.yearArr.push(t);for(let t=0;t<12;t++)this.monthArr.push(t+1);this.weekDay="一二三四五六日".split(""),this.gan="甲乙丙丁戊己庚辛壬癸".split(""),this.zhi="子丑寅卯辰巳午未申酉戌亥".split(""),this.chineseZodiac="鼠牛虎兔龙蛇马羊猴鸡狗猪".split(""),this.farmMonthArr=["正月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","腊月"],this.pingMonthArr=["初一","初二","初三","初四","初五","初六","初七","初八","初九","初十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十","廿一","廿二","廿三","廿四","廿五","廿六","廿七","廿八","廿九"],this.runMonthArr=[...this.pingMonthArr,"三十"],this.farmDate=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,28309,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42448,83315,21200,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46496,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,21952,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19415,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448],this.farmDateArr=this.parseFarmInfoByHexCode(this.farmDate);let t=new Date,e=t.getFullYear(),r=t.getMonth()+1,h=t.getDate();this.today=t,this.searchDay={year:e,month:r,day:h},this.searchLastThreeMonthDay(this.searchDay),this.calFarmInfo(this.searchDay)}reset(){this.lastThreeMonthDay=[],this.currentMonthDay=[]}searchLastThreeMonthDay(t){let e=t.year,r=t.month,h=1===r?e-1+"/12/15":`${e}/${r-1}/15`,a=12===r?`${e+1}/1/15`:`${e}/${r+1}/15`;this.prevMonthObj={year:1===r?e-1:e,month:1===r?12:r-1,day:15},this.nextMonthObj={year:12===r?e+1:e,month:12===r?1:r+1,day:15};let s=new Date(h).getTime(),n=new Date(a).getTime(),i=864e5,o=Math.floor((n-s)/i);for(let t=0;t<o;t++)this.lastThreeMonthDay.push(this.timeStampToDate(t*i+s));this.searchCurrentMonthDay(t)}timeStampToDate(t){let e=new Date(t);return{date:`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`,weekDay:e.getDay()}}searchCurrentMonthDay(t){let e=`${t.year}/${t.month}/1`,r=new Date(t.year,t.month,0).getDate(),h=`${t.year}/${t.month}/${r}`,a=0,s=28;for(let t=0;t<this.lastThreeMonthDay.length;t++)if(this.lastThreeMonthDay[t].date===e&&(a=t),this.lastThreeMonthDay[t].date===h){s=t;break}let n=a-(0==this.lastThreeMonthDay[a].weekDay?7:this.lastThreeMonthDay[a].weekDay),i=s+(6-this.lastThreeMonthDay[s].weekDay);for(let t=1;t<=i-n+1;t++){let e=this.lastThreeMonthDay[n+t],r=e.date.split("/").pop(),h=n+t>=a&&n+t<=s,i=6===e.weekDay||0===e.weekDay;this.currentMonthDay.push({date:r,isCurrentMonth:h,isHoliday:i})}}search(t){let e=t.split(""),r=[];e.forEach((t=>{r.push(isNaN(Number(t))?"|":t)}));let h=this.arrTransToNum(r.join("").split("|"));this.reset(),this.searchDay={year:h[0],month:h[1],day:h[2]},this.searchLastThreeMonthDay(this.searchDay),this.calFarmInfo(this.searchDay)}arrTransToNum(t){let e=[];return t.forEach((t=>{e.push(Number(t))})),e}calFarmInfo(t){let e=t.year,r=t.month,h=t.day,a=new Date("1900/01/31").getTime(),s=new Date(`${e}/${r}/${h}`).getTime(),n=Math.floor((s-a)/864e5);this.currentMonthFarmDay=this.calCurrentMonthFarmInfo(this.currentMonthDay,this.farmDateArr,n)}parsetMonthInfo(t){let e=t.length,r=parseInt(t.slice(e-4,e),2),h=t.slice(0,e-4).split("");return 11===h.length&&h.unshift("0","0"),12===h.length&&h.unshift("0"),[Number(h.shift()),h,r]}parseFarmInfoByHexCode(t){let e=[];for(let r=0;r<t.length;r++){let h=t[r].toString(2),a=this.parsetMonthInfo(h),s=a[0],n=a[1],i=a[2];for(let t=0;t<n.length;t++){if((0===Number(n[t])?this.pingMonthArr:this.runMonthArr).forEach((h=>{let a={year:this.yearArr[r],month:this.farmMonthArr[t],day:h,isRunMonth:!1};e.push(a)})),i===this.monthArr[t]){(0===s?this.pingMonthArr:this.runMonthArr).forEach((h=>{let a={year:this.yearArr[r],month:this.farmMonthArr[t],day:h,isRunMonth:!0};e.push(a)}))}}}return e}calCurrentMonthFarmInfo(t,e,r){let h=0,a=0,s=[];for(let e=0;e<t.length;e++)if(t[e].isCurrentMonth){h=e,a=t.length-e;break}for(let e=r-h;e<r+a;e++){let h={year:this.farmDateArr[e].year,month:this.farmDateArr[e].month,day:this.farmDateArr[e].day,isCurrentMonth:e>=r&&e<=r+t.length};s.push(h)}return s}}const calendar=new Calendar;module.exports=calendar;